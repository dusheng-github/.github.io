(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{372:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));i(161);var s=i(440),o=i(1),l=i(389),a=i.n(l);function r(){return a.a.get("token")}var n={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};i(159),i(160);function d(e){let t="";for(const s of Object.keys(e)){const o=e[s];var i=encodeURIComponent(s)+"=";if(null!==o&&""!==o&&void 0!==o)if("object"==typeof o){for(const e of Object.keys(o))if(null!==o[e]&&""!==o[e]&&void 0!==o[e]){t+=encodeURIComponent(s+"["+e+"]")+"="+encodeURIComponent(o[e])+"&"}}else console.log(i,encodeURIComponent(o)),t+=i+encodeURIComponent(o)+"&"}return t}var u={session:{set(e,t){sessionStorage&&null!=e&&null!=t&&sessionStorage.setItem(e,t)},get:e=>sessionStorage?null==e?null:sessionStorage.getItem(e):null,setJSON(e,t){null!=t&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(null!=t)return JSON.parse(t)},remove(e){sessionStorage.removeItem(e)}},local:{set(e,t){localStorage&&null!=e&&null!=t&&localStorage.setItem(e,t)},get:e=>localStorage?null==e?null:localStorage.getItem(e):null,setJSON(e,t){null!=t&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);if(null!=t)return JSON.parse(t)},remove(e){localStorage.removeItem(e)}}};i(390);s.a.defaults.headers["Content-Type"]="application/json;charset=utf-8";const c=s.a.create({baseURL:process.env.VUE_APP_BASE_API,timeout:1e4});c.interceptors.request.use(e=>{const t=!1===(e.headers||{}).isToken,i=!1===(e.headers||{}).repeatSubmit;if(r()&&!t&&(e.headers.token=r()),"get"===e.method&&e.params){let t=e.url+"?"+d(e.params);t=t.slice(0,-1),e.params={},e.url=t}const{pageSize:s,pageNum:o}=e.data||{};if(s&&o&&(e.url=e.url.includes("?")?`${e.url}&pageNum=${o}&pageSize=${s}`:`${e.url}?pageNum=${o}&pageSize=${s}`),!i&&("post"===e.method||"post"===e.method)){const t={url:e.url,data:"object"==typeof e.data?JSON.stringify(e.data):e.data,time:(new Date).getTime()},i=u.session.getJSON("sessionObj");if(null==i||""===i)u.session.setJSON("sessionObj",t);else{const e=i.url,s=i.data,o=i.time,l=500;if(s===t.data&&t.time-o<l&&e===t.url&&!e.includes("common/upload")){const t="数据正在处理，请勿重复提交";return console.warn(`[${e}]: `+t),Promise.reject(new Error(t))}u.session.setJSON("sessionObj",t)}}return e},e=>{console.log(e),Promise.reject(e)}),c.interceptors.response.use(e=>{const t=e.data.code||200,i=n[t]||e.data.msg||n.default;return"blob"===e.request.responseType||"arraybuffer"===e.request.responseType?e.data:500===t?(Object(o.Message)({message:i,type:"error"}),Promise.reject(new Error(i))):200!==t?(o.Notification.error({title:i}),Promise.reject("error")):e.data},e=>{console.log("err"+e);let{message:t}=e;return"Network Error"==t?t="后端接口连接异常":t.includes("timeout")?t="系统接口请求超时":t.includes("Request failed with status code")&&(t="系统接口"+t.substr(t.length-3)+"异常"),Object(o.Message)({message:t,type:"error",duration:5e3}),Promise.reject(e)});var p=c;function h(e){return console.log(e,p),p({url:"/common/upload",method:"post",data:e})}},396:function(e,t,i){},434:function(e,t,i){"use strict";i(396)},452:function(e,t,i){"use strict";i.r(t);i(159);var s=i(372),o={name:"A",props:{value:[String,Object,Array],limit:{type:Number,default:5},fileSize:{type:Number,default:5},fileType:{type:Array,default:()=>["png","jpg","jpeg","bmp"]},isShowTip:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isOrigin:{type:Boolean,default:!1}},data:()=>({number:0,uploadList:[],dialogImageUrl:"",dialogVisible:!1,hideUpload:!1,baseUrl:process.env.VUE_APP_BASE_API,show:!0,uploadImgUrl:process.env.VUE_APP_BASE_API+"/common/upload",headers:{},fileList:[]}),computed:{showTip:{get(){return console.log(this.isShowTip,this,this.show,this.fileType),this.isShowTip&&(this.fileType||this.fileSize)}}},watch:{value:{handler(e){if(!e)return this.fileList=[],[];{console.log(e,44);let t=Array.isArray(e)?e:this.value.split(",");Array.isArray(e)&&"object"==typeof e[0]&&(t=e.map(e=>e.path||e.url)),this.fileList=t.map(e=>("string"==typeof e&&(e=e.startsWith("http")?{name:e,url:e}:{name:this.baseUrl+e,url:this.baseUrl+e}),e))}},deep:!0,immediate:!0}},mounted(){this.$nextTick(()=>{document.querySelector(".component-upload-image .is-disabled")&&(this.show=!1)})},methods:{changeFile(e){const t=new FormData;t.append("file",e.file),Object(s.a)(t).then(e=>{0===e.code&&this.handleUploadSuccess(e.data)}).catch(e=>{this.$modal.closeLoading(),this.handleUploadError()})},handleRemove(e,t){console.log(this.fileList,e.name);const i=this.fileList.map(e=>e.name).indexOf(e.name);i>-1&&(console.log(i),this.fileList.splice(i,1),this.$emit("input",this.listToString(this.fileList)))},handleUploadSuccess(e){console.log(e,this.number,this.uploadList.length),this.uploadList.push({name:e.originalFilename,url:e.url}),this.uploadList.length===this.number&&(this.fileList=this.fileList.concat(this.uploadList),this.uploadList=[],this.number=0,this.$emit("input",this.listToString(this.fileList)),this.$modal.closeLoading())},handleBeforeUpload(e){console.log(e,"file",this.number);let t=!1;if(this.fileType.length){let i="";e.name.lastIndexOf(".")>-1&&(i=e.name.slice(e.name.lastIndexOf(".")+1)),t=this.fileType.some(t=>e.type.indexOf(t)>-1||!!(i&&i.indexOf(t)>-1))}else t=e.type.indexOf("image")>-1;if(!t)return this.$modal.msgError(`文件格式不正确, 请上传${this.fileType.join("/")}图片格式文件!`),!1;if(this.fileSize){if(!(e.size/1024/1024<this.fileSize))return this.$modal.msgError(`上传头像图片大小不能超过 ${this.fileSize} MB!`),!1}this.$modal.loading("正在上传图片，请稍候..."),this.number++},handleExceed(){this.$modal.msgError(`上传文件数量不能超过 ${this.limit} 个!`)},handleUploadError(){this.$modal.msgError("上传图片失败，请重试"),this.$modal.closeLoading()},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},listToString(e){var t;return this.isOrigin?e:this.limit>1?e.map(e=>e.url):(null===(t=e[0])||void 0===t?void 0:t.url)||""}}},l=(i(434),i(30)),a=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"component-upload-image"},[t("el-upload",{class:{hide:e.fileList.length>=e.limit},attrs:{multiple:"",action:"","list-type":"picture-card","on-success":e.handleUploadSuccess,"before-upload":e.handleBeforeUpload,limit:e.limit,"on-error":e.handleUploadError,"on-exceed":e.handleExceed,name:"file","on-remove":e.handleRemove,"show-file-list":!0,headers:e.headers,"file-list":e.fileList,"http-request":e.changeFile,disabled:e.disabled,"on-preview":e.handlePictureCardPreview}},[t("i",{staticClass:"el-icon-plus"})]),e._v(" "),e.showTip?t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("\n    请上传\n    "),e.fileSize?[e._v("\n      大小不超过 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.fileSize)+"MB")])]:e._e(),e._v(" "),e.fileType?[e._v("\n      格式为 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.fileType.join("/")))])]:e._e(),e._v("\n    的图片\n  ")],2):e._e(),e._v(" "),t("el-dialog",{attrs:{visible:e.dialogVisible,title:"预览",width:"800","append-to-body":""},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{staticStyle:{display:"block","max-width":"100%",margin:"0 auto"},attrs:{src:e.dialogImageUrl}})])],1)}),[],!1,null,"ab36643e",null);t.default=a.exports}}]);